
#include <avr/io.h>
#include <stdio.h>


void serial_init(void){
	// Asynchronous mode, no parity, 1 stop bit, 8 data bits
	UCSRC = 0b10000110;
	// Normal speed, disable multi-proc
	UCSRA = 0b00000000;
	// Baud rate 1200bps, assuming 1MHz clock
	UBRRL = 0x33;
	UBRRH = 0x00;
	// Enable Tx and Rx, disable interrupts
	UCSRB = 0b00011000;
}


int serial_send(char c, FILE *stream){
  while ((UCSRA & (1 << UDRE)) == 0x00){;}
    UDR = c; // Write character to UDR for transmission
  return 0;
}

int serial_receive(FILE *stream){
// Wait until RXC flag is set to logic 1
while ((UCSRA & (1 << RXC)) == 0x00){;}
return UDR; // Read the received character from UDR
}

int main(void){
  unsigned int a;

  stdout = fdevopen(serial_send, NULL);
  stdin = fdevopen(NULL, serial_receive);
  
while (1){
    printf(“\n\rEnter a = ");
    scanf(“%d”, &a); printf(“%d”, a);
  }
}
